<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="result">

<typeAlias alias="investDto" type="product.bean.InvestDto"/>
<typeAlias alias="messageDto" type="result.bean.MessageDto"/>
<typeAlias alias="registerDto" type="product.bean.RegisterDto"/>
<typeAlias alias="settingDto" type="setting.bean.SettingDto"/>
<typeAlias alias="tableDto" type="product.bean.TableDto"/>
<typeAlias alias="borrowDto" type="product.bean.BorrowDto"/>

<select id="getmessage" resultClass="messageDto" parameterClass="int">
	select * from message where m_memno=#no# order by m_time desc
</select>

<select id="in_history" resultClass="investDto" parameterClass="int">
	select * from invest i,product p  where i.i_pcode=p.p_code and i.i_memnum = #no# order by i.i_date desc
</select> 

<select id="investcheck" resultClass="int" parameterClass="java.util.Map">
	select count(*) from invest where i_memnum=#no# and i_pcode=#p_code#
</select>

<select id="oneget_i" resultClass="investDto" parameterClass="java.util.Map">
	select * from invest where i_memnum = #no# and i_pcode=#p_code#
</select>

<select id="remmitance_before" resultClass="registerDto">
	select * from product p,memberinfo m where p.p_memeno = m.no and p.p_success != 'refunds' order by p.no desc
</select>

<select id="remmitance_after" resultClass="registerDto">
	select * from product p,memberinfo m where p.p_memeno = m.no and p.p_success = 'refunds' order by p.no desc
</select>

<select id="refunds_ing" resultClass="registerDto">
	select * from product p,memberinfo m where p.p_memeno = m.no and p.p_success = 'refunds' and p.p_term != p.p_funding  order by p.no desc
</select>

<select id="refunds_end" resultClass="registerDto">
	select * from product p,memberinfo m where p.p_memeno = m.no and p.p_success = 'overend'
</select>

<select id="matchday" resultClass="String">
	select p_repayday from product where p_success = 'refunds' order by no desc
</select>

<select id="getloan" resultClass="tableDto" parameterClass="String">
	select * from dj_$str$ order by no asc
</select>

<select id="getoneloan" resultClass="tableDto" parameterClass="String">
	select * from dj_$str$ where no=1
</select>

<select id="getborrow" resultClass="borrowDto" parameterClass="int">
	select * from borrow where memno=#no#
</select>

<select id="product_check" resultClass="int" parameterClass="int">
	select count(*) from product where p_brno = #br_no#
</select>

<select id="product_code" resultClass="String" parameterClass="int">
	select p_code from product where p_brno = #br_no#
</select>

<select id="minno" resultClass="int" parameterClass="String">
	select min(no) from dj_$str$ where back=0
</select> 

<select id="max_refunds_no" resultClass="int" parameterClass="String">
	select max(no) from dj_$str$ where back=1 
</select>
<!-- manager로 옮기기 -->
<select id="investcount" resultClass="int">
	select count(*) from invest
</select>

<select id="investpcode" resultClass="String">
	select i_pcode from invest
</select>

<select id="investway" resultClass="int" parameterClass="String">
	select count(i_way) from invest where i_way=#i_way#
</select>

<select id="investage" resultClass="String">
	select m.birth from memberinfo m, invest i where m.no = i.i_memnum
</select>

<select id="investgender" resultClass="String">
	select m.gender from memberinfo m, invest i where m.no = i.i_memnum
</select>

<!-- 여기까지 -->

<select id="alarm" resultClass="int" parameterClass="int">
	select count(m_check) from message where m_memno=#no# and m_check=1
</select>

<insert id="refunds_insert" parameterClass="java.util.Map">
	insert into refunds values(refunds_seq.nextval,#p_code#,#times#,sysdate)
</insert>

<update id="completeinvest" parameterClass="registerDto">
	update invest set i_success=#p_success# where i_pcode=#p_code#
</update>

<update id="completefund" parameterClass="registerDto">
	update product set p_success=#p_success# where p_code=#p_code#
</update>

<update id="readed" parameterClass="int">
	update message set m_check=0 where m_memno=#no#
</update>

<update id="back_update" parameterClass="java.util.Map">
	update dj_$str$ set back=1 where no=#times#
</update>

<update id="fundingup" parameterClass="java.util.Map">
	update product set p_funding=#times# where p_code=#p_code#
</update>
</sqlMap>